---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# overtureR <a href="https://arthurgailes.github.io/overtureR/"><img src="man/figures/logo.png" align="right" height="139" alt="overtureR website" /></a>


<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/overtureR)](https://CRAN.R-project.org/package=overtureR)
[![R-CMD-check](https://github.com/arthurgailes/overtureR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/arthurgailes/overtureR/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/arthurgailes/overtureR/branch/master/graph/badge.svg)](https://app.codecov.io/gh/arthurgailes/overtureR?branch=master)
<!-- badges: end -->

## Installation

```{r eval=FALSE}
# CRAN application pending
# install.packages("overtureR")
devtools::install_github("arthurgailes/overtureR")
```


## Usage

Replicating `duckdb` examples fromm the [Overture docs](https://docs.overturemaps.org/getting-data/duckdb/)

```{r counties, warning=FALSE}
library(overtureR)
library(dplyr)
library(ggplot2)

counties <- open_curtain("division_area") |>
  # in R, filtering on variables must come before removing them via select
  filter(subtype == "county" & country == "US" & region == "US-PA") |>
  transmute(
    id,
    division_id,
    # STRUCT/MAP columns can be accessed as column[["subcolumn"]] in transmute
    primary = names[["primary"]],
    geometry
  )

# Plot the results
counties |>
  collect_sf() |>
  ggplot() +
  geom_sf(aes(fill = as.numeric(sf::st_area(geometry))))
```

```{r mountains}
library(overtureR)
library(dplyr)

# lazily load the full `mountains` dataset
mountains <- open_curtain(type = "*", theme = "places") |>
  transmute(
    id,
    primary_name = names[["primary"]],
    x = bbox[["xmin"]],
    y = bbox[["ymin"]],
    main_category = categories[["primary"]],
    primary_source = sources[[1]][["dataset"]],
    confidence,
    geometry # currently no duckdb spatial implementation
  ) |>
  filter(main_category == "mountain" & confidence > .90)

head(mountains)
```


## Roadmap

- Load all possible views into conn
- Add beta/alpha datasets
- Install and load duckdb spatial
- Allow mirror/local reads via base_url
- Remove duckdbfs dependency
- Add mapping vignettes
- Use pmtiles
- Remove dbplyr dependencies
- Add function to write data (stage_write)
- Add function to preload all types as views
